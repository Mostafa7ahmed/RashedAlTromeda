<div class="overlaypopup"></div>

<div class="addsuggest" [formGroup]="form">
  <div class="headerpopup d-flex justify-content-between align-items-center">
<h5>{{ 'ADD_SUGGESTION' | translate }}</h5>
    <div class="icons cr" (click)="closePopup()">
      <i class="fa-solid fa-circle-xmark"></i>
    </div>
  </div>

  <div class="bodyAdd">
    <div class="contentPopup d-flex flex-column gap-3 mt-4">

      <!-- ðŸŸ¢ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ -->
      <div class="fromGroup">
<label for="title">{{ 'TITLE' | translate }}</label>
<input id="title" type="text" placeholder="{{ 'TITLE' | translate }}" formControlName="title" />
        <small class="error" *ngIf="form.get('title')?.touched && form.get('title')?.hasError('required')">
          {{ 'REQUIRED_FIELD' | translate }}
        </small>
      </div>

      <!-- ðŸŸ¢ ÙˆØµÙ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ -->
      <div class="fromGroup">
<label for="description">{{ 'DESCRIPTION' | translate }}</label>
<textarea id="description" placeholder="{{ 'DESCRIPTION' | translate }}" formControlName="description"></textarea>
        <small class="error" *ngIf="form.get('description')?.touched && form.get('description')?.hasError('required')">

          {{ 'REQUIRED_FIELD' | translate }}
        </small>
      </div>

      <!-- ðŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± -->
      <div class="upload-images">
        <div class="upload-box" (click)="fileInputImages.click()">
       <img src="Icons/addimage.svg" alt="add-image" />
    <p class="title">{{ 'UPLOAD_IMAGES' | translate }}</p>
    <label class="browse">{{ 'UPLOAD_IMAGES' | translate }}</label>
          <input type="file" #fileInputImages multiple accept="image/*" (change)="onFilesSelected($event)" hidden />
        </div>

        <div class="preview-section" *ngIf="images().length > 0">
          <div class="preview-header">
            <span>{{ 'UPLOAD_COUNT' | translate:{count: images().length} }}</span>
          </div>

          <div class="preview-list">
            <div class="preview-item" *ngFor="let img of images(); let i = index">
              <ng-container *ngIf="img.isUploading; else uploadedImage">
                <div class="loading-placeholder">
                  <i class="fa-solid fa-spinner fa-spin"></i>
                </div>
              </ng-container>

              <ng-template #uploadedImage>
                <img [src]="baseUrl + img.url" alt="preview" />
                <button class="remove-btn" (click)="removeImage(i)">
                  <i class="fa-solid fa-xmark"></i>
                </button>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <div class="upload-record-container">
        <div class="card" (click)="fileInput.click()">
          <input type="file" #fileInput multiple (change)="onFileSelectedPDF($event)" hidden />
          <i class="fa-solid fa-cloud-arrow-up"></i>
          <p class="m-0">{{ 'UPLOAD_FILES' | translate }}</p>
        </div>
        <div class="record-card card">
          <!-- Ø²Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
<button class="record-btn btn" *ngIf="!audioUrl()" (click)="toggleRecording()">
  <i class="fa-solid" [ngClass]="isRecording() ? 'fa-stop' : 'fa-microphone'"></i>
            <p class="m-0" [ngClass]="!isRecording() ? 'd-block' : 'd-none'">{{ 'RECORD_AUDIO' | translate }}</p>
</button>

<!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
<div class="record-indicator" *ngIf="isRecording()">
  <span class="dot"></span>
  <span>ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†...</span>
</div>

<!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹ -->
<div class="audio-uploading" *ngIf="isUploadingAudio()">
  <i class="fa-solid fa-spinner fa-spin"></i>
            <span>{{ 'RECORDING_NOW' | translate }}</span>
</div>

<!-- Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹ -->
<div *ngIf="!isUploadingAudio() && uploadedVoiceUrl()" class="audio-player d-flex gap-2">
  <audio controls [src]="baseUrl + uploadedVoiceUrl()"></audio>
  <button class="btndelete" (click)="deleteAudio()">
    <i class="fa-solid fa-trash"></i>
  </button>
</div>
        </div>
      </div>


      <div class="files-preview" *ngIf="uploadedFiles().length > 0">
        <div class="file-item" *ngFor="let file of uploadedFiles(); let i = index">
          <i class="fa-solid fa-file"></i>

          <!-- Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
          <span *ngIf="file.isUploading" class="uploading">
            <span>{{ 'UPLOADING_AUDIO' | translate }}</span>
            <i class="fa-solid fa-spinner fa-spin"></i>
          </span>

          <span *ngIf="!file.isUploading">{{ file.name }}</span>

          <button *ngIf="!file.isUploading" (click)="removeFile(i)">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button (click)="addSuggest()" class="close-btn" [disabled]="form.invalid || isUploading() || isUploadingImage()">
{{ 'SAVE' | translate }}    </button>
  </div>
</div>