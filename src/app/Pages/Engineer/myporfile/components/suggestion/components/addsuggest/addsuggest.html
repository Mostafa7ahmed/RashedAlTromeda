<div class="overlaypopup"></div>

<div class="addsuggest" [formGroup]="form">
  <div class="headerpopup d-flex justify-content-between align-items-center">
    <h5>ุงุถุงูุฉ ุงูุชุฑุงุญ</h5>
    <div class="icons cr" (click)="closePopup()">
      <i class="fa-solid fa-circle-xmark"></i>
    </div>
  </div>

  <div class="bodyAdd">
    <div class="contentPopup d-flex flex-column gap-3 mt-4">

      <!-- ๐ข ุนููุงู ุงูุงูุชุฑุงุญ -->
      <div class="fromGroup">
        <label for="title">ุนููุงู ุงูุงูุชุฑุงุญ</label>
        <input id="title" type="text" placeholder="ุงุฏุฎู ุนููุงู ุงูุงูุชุฑุงุญ" formControlName="title" />
        <small class="error" *ngIf="form.get('title')?.touched && form.get('title')?.hasError('required')">
          ูุฐุง ุงูุญูู ูุทููุจ
        </small>
      </div>

      <!-- ๐ข ูุตู ุงูุงูุชุฑุงุญ -->
      <div class="fromGroup">
        <label for="description">ูุตู ุงูุงูุชุฑุงุญ</label>
        <textarea id="description" placeholder="ุงูุชุจ ุงูููุถูุน ููุง" formControlName="description"></textarea>
        <small class="error" *ngIf="form.get('description')?.touched && form.get('description')?.hasError('required')">
          ูุฐุง ุงูุญูู ูุทููุจ
        </small>
      </div>

      <!-- ๐ข ุชุญููู ุงูุตูุฑ -->
      <div class="upload-images">
        <div class="upload-box" (click)="fileInputImages.click()">
          <img src="Icons/addimage.svg" alt="add-image" />
          <p class="title">ุชุญููู ุตูุฑ ูุชุนุฏุฏุฉ</p>
          <label class="browse">ุชุตูุญ</label>
          <input type="file" #fileInputImages multiple accept="image/*" (change)="onFilesSelected($event)" hidden />
        </div>

        <div class="preview-section" *ngIf="images().length > 0">
          <div class="preview-header">
            <span>ุชุญููู {{ images().length }} ุตูุฑ</span>
          </div>

          <div class="preview-list">
            <div class="preview-item" *ngFor="let img of images(); let i = index">
              <ng-container *ngIf="img.isUploading; else uploadedImage">
                <div class="loading-placeholder">
                  <i class="fa-solid fa-spinner fa-spin"></i>
                </div>
              </ng-container>

              <ng-template #uploadedImage>
                <img [src]="baseUrl + img.url" alt="preview" />
                <button class="remove-btn" (click)="removeImage(i)">
                  <i class="fa-solid fa-xmark"></i>
                </button>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <div class="upload-record-container">
        <div class="card" (click)="fileInput.click()">
          <input type="file" #fileInput multiple (change)="onFileSelectedPDF($event)" hidden />
          <i class="fa-solid fa-cloud-arrow-up"></i>
          <p class="m-0">ุชุญููู ูููุงุช</p>
        </div>
        <div class="record-card card">
          <!-- ุฒุฑ ุงูุชุณุฌูู -->
<button class="record-btn btn" *ngIf="!audioUrl()" (click)="toggleRecording()">
  <i class="fa-solid" [ngClass]="isRecording() ? 'fa-stop' : 'fa-microphone'"></i>
  <p class="m-0" [ngClass]="!isRecording() ? 'd-block' : 'd-none'">ุชุณุฌูู ุตูุช</p>
</button>

<!-- ุญุงูุฉ ุงูุชุณุฌูู -->
<div class="record-indicator" *ngIf="isRecording()">
  <span class="dot"></span>
  <span>ูุชู ุงูุชุณุฌูู ุงูุขู...</span>
</div>

<!-- ุญุงูุฉ ุงูุฑูุน -->
<div class="audio-uploading" *ngIf="isUploadingAudio()">
  <i class="fa-solid fa-spinner fa-spin"></i>
  <span>ุฌุงุฑู ุฑูุน ุงูุตูุช...</span>
</div>

<!-- ุนุฑุถ ุงูุตูุช ุจุนุฏ ุงูุฑูุน -->
<div *ngIf="!isUploadingAudio() && uploadedVoiceUrl()" class="audio-player d-flex gap-2">
  <audio controls [src]="baseUrl + uploadedVoiceUrl()"></audio>
  <button class="btndelete" (click)="deleteAudio()">
    <i class="fa-solid fa-trash"></i>
  </button>
</div>
        </div>
      </div>


      <div class="files-preview" *ngIf="uploadedFiles().length > 0">
        <div class="file-item" *ngFor="let file of uploadedFiles(); let i = index">
          <i class="fa-solid fa-file"></i>

          <!-- ุฃุซูุงุก ุงูุชุญููู -->
          <span *ngIf="file.isUploading" class="uploading">
            ุฌุงุฑู ุฑูุน
            <i class="fa-solid fa-spinner fa-spin"></i>
          </span>

          <span *ngIf="!file.isUploading">{{ file.name }}</span>

          <button *ngIf="!file.isUploading" (click)="removeFile(i)">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="actions">
    <button (click)="addSuggest()" class="close-btn" [disabled]="form.invalid || isUploading() || isUploadingImage()">
      ุงุถุงูุฉ ุงูุชุฑุงุญ
    </button>
  </div>
</div>